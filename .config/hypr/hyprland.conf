# HYPRLAND - alba4k
#
# Documentation: https://wiki.hyprland.org
#
# Dependencies:
#
#  System Tray:
#   - blueman (bluetooth manager)
#   - nm-applet (network manager)
#   - kdeconnect (phone - computer interface)
#
#  Stuff I use:
#   - custom scripts and sounds
#   - i3-battery-popup (battery warning)
#   - waybar (bar)
#   - dunst (notifications)
#   - rofi (Launcher)
#   - libinput-gestures (trackpad gestures)
#   - hyprpaper (background)
#   - lxsession (policy kit)
#   - wl-clip-persist (persistent clipboard)
#   - cliphist (clipboard manager)
#   - flameshot (screenshots)
#   - grimblast (screenshots but working)
#   - swayidle (session management)
#   - xwaylandvideobridge (currently disabled, screensharing) 
#
#  Keybinds:
#   - pactl (volume control)
#   - light (brightness)
#   - playerctl (media controls)
#   - emote (emoji selector)
#   - systemd (poweroff, suspend, ...)


##############################################
###              BASIC SETUP               ###
##############################################

input {
    kb_layout = ch
    kb_variant = de

    numlock_by_default = true

    follow_mouse = 1

    natural_scroll = 0
    touchpad {
        disable_while_typing = 0
        natural_scroll = 1
    }
}

xwayland {
    force_zero_scaling = true
}

debug {
    # overlay = true
    # disable_logs = true
}

env = XDG_SESSION_DESKTOP, Hyprland

##############################################
###               AUTOSTART                ###
##############################################

# Bar
exec = killall -9 waybar; waybar

# Just in case I might get them to autoconnect
exec = bluetoothctl connect 18:26:54:3C:0F:AD # Galaxy S23
exec = bluetoothctl connect 80:9F:F5:BF:C4:80 # Galaxy Buds Pro

# Keyboard backlight
exec = sudo g413-led -a 770000

# Background (different config, ~/.config/hypr/hyprpaper.conf)
exec-once = hyprpaper

# Starting dunst (different config)
exec = dunst -conf '~/.config/dunstrc'

# PolKit Agent
exec = sleep 1; lxpolkit

# Cliphist
# exec-once = wl-paste --type text --watch cliphist store
exec-once = wl-paste --watch cliphist store

# Daemons
exec-once = thunar --daemon
exec = flameshot
exec = /usr/lib/kdeconnectd
exec-once = ~/.config/hypr/volbright.sh --brightness --keyboard --volume
exec-once = ~/.config/hypr/ac_detect.sh
exec-once = i3-battery-popup -n -D -L 20 -m 'Battery is getting low!' -t 3m -s ~/.config/hypr/click.ogg -v 50
exec-once = emote

# System Tray stuff used in waybar
exec-once = nm-applet
exec-once = blueman-applet # doesn't show but starts blueman

# Clipboard manager
exec-once = wl-clip-persist -c both

# GTK shit
exec-once = gsettings set org.gnome.desktop.interface cursor-theme Breeze
exec-once = gsettings set org.gnome.desktop.interface gtk-theme Catppuccin-purple
exec-once = gsettings set org.gnome.desktop.interface icon-theme Papirus-Dark
exec-once = gsettings set org.gnome.desktop.interface "Noto Sans Display Regular"

# Manage logind events
exec-once = swayidle -w

# Restart xdg-desktop-portal
exec-once = systemctl --user import-environment QT_QPA_PLATFORMTHEME
exec-once = ~/.config/hypr/xdg-desktop-portal.sh

# XWayland Video Bridge
# While this may be useful, I keep it disabled because it keeps a window in the 1st workspace. Might fix it using the special one
#exec-once = xwaylandvideobridge


##############################################
###                 SETUP                  ###
##############################################

# Monitor configuration (The random numbers are for 1920x1080@72)
monitor = eDP-1, 1920x1200@60, 0x0, 1
monitor = DP-7, 1920x1080@72, 0x0, 1
monitor = DP-5, 1920x1080@72, 1920x0, 1
#exec = hyprctl monitors | grep DP-7 && hyprctl keyword monitor "eDP-1, disabled" || hyprctl keyword monitor "eDP-1, 1920x1200, 0x0, 1"
monitor = , preferred, auto, 1
exec = ~/.screenlayout/W-auto.sh

bind = SUPERCTRL, X, exec, hyprctl keyword monitor eDP-1,1920x1200@60,0x0,1
#exec-once = kanshi

# Hyprland settings
general {
    gaps_in = 5
    gaps_out = 10
    border_size = 5
    col.active_border = 0xff8957b0 0xff7949d0
    col.inactive_border = 0x906e73b0

    sensitivity = 0.6

    apply_sens_to_raw = false
}

gestures {
    workspace_swipe = true
    workspace_swipe_fingers = 3

    workspace_swipe_create_new = true
    workspace_swipe_forever = true
}
exec-once = libinput-gestures -c ~/.config/libinput-gestures-wayland.conf

# Window decorations
decoration {
    rounding = 12

    active_opacity = 1
    inactive_opacity = 0.8
    fullscreen_opacity = 1
    
    blur {
        enabled = true
        size = 8
        passes = 2
        ignore_opacity = true
    }

    drop_shadow = false
}

misc {
    disable_hyprland_logo = true
    disable_splash_rendering = true

    disable_autoreload = true # hyprctl reload to manually reload

    animate_manual_resizes = true
    animate_mouse_windowdragging = true

    mouse_move_enables_dpms = true
    key_press_enables_dpms = true

    enable_swallow = true
    swallow_regex = kitty

    vfr = true
    vrr = 1

    allow_session_lock_restore = true
}

# Session management
bind = SUPERSHIFT, Q, exit,
bind = SUPERSHIFT, R, exec, hyprctl reload
bind = SUPERCTRL, L, exec, ~/.config/hypr/lock.sh
bind = SUPERCTRL, K, exec, ~/.config/hypr/lock.sh && systemctl suspend

# I have a custom macro for it on my laptop so why not use it :)
# https://bit.ly/3NMpzlK (Fn+F9)
bind = SUPER, P, exec, systemctl suspend-then-hibernate


##############################################
###               ANIMATIONS               ###
##############################################

animations {
    enabled = 1
}

animation = windows, 1, 7, default
animation = workspaces, 1, 6, default, slide
#animation = workspaces, 1, 6, default, slidevert

# Sliding stuff
windowrule = animation slide, Lxpolkit
windowrulev2 = animation slide, class:(flameshot), title:(flameshot)

##############################################
###     WINDOW AND WORKSPACE MANAGMENT     ###
##############################################

binds {
    workspace_back_and_forth = true
    allow_workspace_cycles = true
}


bind = SUPER, Q, killactive,

bind = SUPER, F, fullscreen, 0
bind = SUPERSHIFT, F, togglefloating,

# Moving windows with the mouse
bindm = SUPER, mouse:272, movewindow
bindm = SUPER, mouse:273, resizewindow

# Moving window focus
bind = SUPER, left, movefocus, l
bind = SUPER, right, movefocus, r
bind = SUPER, up, movefocus, u
bind = SUPER, down, movefocus, d
bind = SUPER, H, movefocus, l
bind = SUPER, L, movefocus, r
bind = SUPER, K, movefocus, 
bind = SUPER, J, movefocus, d

# Moving windows
bind = SUPERSHIFT, left, movewindow, l
bind = SUPERSHIFT, right, movewindow, r
bind = SUPERSHIFT, up, movewindow, u
bind = SUPERSHIFT, down, movewindow, d
bind = SUPERSHIFT, H, movewindow, l
bind = SUPERSHIFT, L, movewindow, r
bind = SUPERSHIFT, K, movewindow, u
bind = SUPERSHIFT, J, movewindow, d

# Resizing windows
bind = SUPERALT, H, resizeactive, -50 0
bind = SUPERALT, L, resizeactive, 50 0
bind = SUPERALT, J, resizeactive, 0 50
bind = SUPERALT, K, resizeactive, 0 -50
bind = SUPERALT, left, resizeactive, -50 0
bind = SUPERALT, right, resizeactive, 50 0
bind = SUPERALT, down, resizeactive, 0 50
bind = SUPERALT, up, resizeactive, 0 -50

bind = SUPER,R,exec, ~/.config/hypr/resize.sh

# Switching workspaces
bind = SUPER, 1, workspace, 1
bind = SUPER, 2, workspace, 2
bind = SUPER, 3, workspace, 3
bind = SUPER, 4, workspace, 4
bind = SUPER, 5, workspace, 5
bind = SUPER, 6, workspace, 6
bind = SUPER, 7, workspace, 7
bind = SUPER, 8, workspace, 8
bind = SUPER, 9, workspace, 9
bind = SUPER, 0, workspace, 10

# Moving window to workspace
bind = SUPERSHIFT, 1, movetoworkspace, 1
bind = SUPERSHIFT, 2, movetoworkspace, 2
bind = SUPERSHIFT, 3, movetoworkspace, 3
bind = SUPERSHIFT, 4, movetoworkspace, 4
bind = SUPERSHIFT, 5, movetoworkspace, 5
bind = SUPERSHIFT, 6, movetoworkspace, 6
bind = SUPERSHIFT, 7, movetoworkspace, 7
bind = SUPERSHIFT, 8, movetoworkspace, 8
bind = SUPERSHIFT, 9, movetoworkspace, 9
bind = SUPERSHIFT, 0, movetoworkspace, 10


##############################################
###                KEYBINDS                ###
##############################################

# Opening a terminal
bind = SUPER, return, exec, kitty --title Kitty
bind = SUPER, T, exec, kitty --title Kitty

# Just QOL lol
bind = SUPER, B, exec, buds

# Power manager
bind = SUPER, backspace, exec, wlogout --protocol layer-shell

# Brightness
bindei = , XF86MonBrightnessUp, exec, fish -c "for i in (seq 50); light -A .1; end; sleep .1; light -G"
bindei = , XF86MonBrightnessDown, exec, fish -c "for i in (seq 50); light -U .1; end; sleep .1; light -G"

# Media
bindi = , XF86AudioPlay, exec, playerctl play-pause
bindi = , XF86AudioPause, exec, playerctl play-pause
bindi = , XF86AudioNext, exec, playerctl next
bindi = , XF86AudioPrev, exec, playerctl previous

# Volume
bindei = , XF86AudioRaiseVolume, exec, pactl set-sink-volume @DEFAULT_SINK@ +10% && pactl set-sink-mute @DEFAULT_SINK@ 0 && paplay --volume 65536 ~/.config/hypr/click.ogg
bindei = , XF86AudioLowerVolume, exec, pactl set-sink-volume @DEFAULT_SINK@ -10% && pactl set-sink-mute @DEFAULT_SINK@ 0 && paplay --volume 65536 ~/.config/hypr/click.ogg
bindi = , XF86AudioMute, exec, pactl set-sink-mute @DEFAULT_SINK@ toggle && paplay --volume 65536 ~/.config/hypr/click.ogg
bindi = , XF86AudioMicMute, exec, pactl set-source-mute @DEFAULT_SOURCE@ toggle

# Rofi
bind = SUPER, D, exec, rofi -show drun 
# bindr = SUPER,Super_L,exec, rofi -show drun
bind = SUPER, C, exec, rofi -show calc
bind = SUPERSHIFT, D, exec, rofi -show run
bind = SUPER, V, exec, ~/.config/rofi/clipboard.sh | rofi -dmenu -display-columns 2 -p "ï™Œ Clipboard" | cliphist decode | wl-copy
bind = SUPERSHIFT, V, exec, cliphist wipe

# ðŸ’€ðŸ’€ðŸ’€
bind = SUPER, period, exec, emote

# Half grimblast half flameshot baucase flameshot is so much better but sometimes breaks (https://github.com/flameshot-org/flameshot/issues/2978)
bind = SUPERSHIFT, S, exec, flameshot gui && hyprctl notify 5 3000 0 "Screenshot copied to the clipboard"
bind = SUPERSHIFTCTRL, S, exec, grimblast --cursor copy area && hyprctl notify 5 3000 0 "Screenshot copied to the clipboard"
bind = , Print, exec, grimblast --cursor copy output && hyprctl notify 5 3000 0 "Screenshot copied to the clipboard"
bind = SHIFT, Print, exec, grimblast --cursor copy screen && hyprctl notify 5 3000 0 "Screenshot copied to the clipboard"
bind = CTRL, Print, exec, grimblast --cursor copy screen && hyprctl notify 5 3000 0 "Screenshot copied to the clipboard"
bind = SUPER, Print, exec, flameshot launcher

# Moving workspaces around
bind = SUPER, X, exec, /home/alba4k/.config/hypr/movetomonitor.sh
bind = SUPERSHIFT, X, exec, /home/alba4k/.config/screenlayout/W-auto.sh

##############################################
###              WINDOW RULES              ###
##############################################

# Disable swayidle when there's a fullscreen window
windowrulev2 = idleinhibit fullscreen, title:.*

# Random apps that I want to float
windowrule = float, seahorse
windowrule = float, qalculate-gtk
windowrule = float, org.prismlauncher.PrismLauncher
windowrule = float, onedriver-launcher
windowrule = float, org.kde.kdeconnect.handler
windowrule = float, python3
windowrulev2 = float, class:(flameshot), title:(Configuration)
windowrulev2 = float, class:(flameshot), title:(Capture Launcher)
windowrulev2 = float, class:(flameshot), title:(Save screenshot)
#windowrule = float, Bitwarden

# Random apps that I DONT want to float
windowrule = tile, ONLYOFFICE Desktop Editors

# Steam games
windowrule = tile, hollow_knight.x86_64
windowrule = tile, hexceed
windowrule = tile, steam_app_271590 # GTA V
windowrule = tile, steam_app_312520 # Rain World
#windowrule = tile, steam_app_322170 # Geometry Dash
windowrule = tile, steam_app_387290 # Ori And The Blind Forest: Definitive Edition
windowrule = tile, steam_app_1172620 # Sea of Thieves

# Border correction - Windows with rounded corners that don't match mine
windowrule = rounding 21, GalaxyBudsClient
windowrule = rounding 15, Rofi # (For default Rofi)

# Settings
windowrule = float, pavucontrol
windowrule = float, blueman-manager
windowrule = float, system-config-printer
windowrule = float, cpupower-gui

# Flameshot
windowrulev2 = suppressevent fullscreen, class:(flameshot), title:(flameshot)
windowrulev2 = rounding 0, class:(flameshot), title:(flameshot)
windowrulev2 = noborder, class:(flameshot), title:(flameshot)
windowrulev2 = monitor DP-7, class:(flameshot), title:(flameshot)
windowrulev2 = float, class:(flameshot), title:(flameshot)
windowrulev2 = move 0 0, class:(flameshot), title:(flameshot)
windowrulev2 = stayfocused, class:(flameshot), title:(flameshot)
windowrulev2 = float, class:(flameshot), title:(Upload image)

# Firefox stuff
windowrulev2 = float, class:(firefox), title:(Picture-in-Picture)
windowrulev2 = keepaspectratio, class:(firefox), title:(Picture-in-Picture)
windowrulev2 = float, class:(firefox), title:(Estensione: (Bitwarden - Gestore di Password Gratis) - Bitwarden â€“ Mozilla Firefox) # doesn't work as the initial title is always "Mozilla Firefox"

# Various authentication stuff
windowrule = stayfocused, Lxpolkit
windowrulev2 = move 634 120, class:(Lxpolkit), title:(Autenticazione)
windowrulev2 = move 830 189, class:(Lxpolkit), title:(Informazione)
windowrulev2 = move 809 189, class:(Lxpolkit), title:(Errore)
windowrulev2 = stayfocused, class:(nm-applet), title:(Richiesta autenticazione rete Wi-Fi)

# XWayland Video Bridge (https://wiki.hyprland.org/Useful-Utilities/Screen-Sharing)
windowrule = opacity 0.0 override 0.0 override, xwaylandvideobridge
windowrule = noanim, xwaylandvideobridge
windowrule = noblur, xwaylandvideobridge
windowrule = nofocus, xwaylandvideobridge
windowrule = noinitialfocus, xwaylandvideobridge

# Dunst
layerrule = blur, notifications
layerrule = ignorezero, notifications

# Rofi (official client)
windowrule = stayfocused, Rofi

# Rofi (lbonn Wayland fork)
layerrule = blur, rofi
layerrule = ignorezero, rofi

# Wlogout
layerrule = blur, gtk-layer-shell

# Waybar
layerrule = blur, waybar
layerrule = ignorezero, waybar

